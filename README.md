# DIYEPW
DIYEPW is a tool developed by Pacific Northwest National Laboratory that allows the quick and easy
generation of a set of EPW files for a given set of WMOs and years. It is provided as both a set
of scripts and as a package that allows EPW files to be generated via function call.

## Scripts
This section describes the scripts available as part of this project.

## 1. analyze_noaa_data.py

The script analyze_noaa_data.py will assess the files in `outputs/NOAA_AMY` folder for:

1. Total number of rows missing
1. Maximum number of consecutive rows missing

and will produce the following files (as applicable) under `outputs/analyze_noaa_data_output/`:

1. `missing_total_entries_high.csv`: A list of files where the total number of rows missing exceeds a threshold.
   The threshold is set to rule out files where more than 700 (out of 8760 total) entries are missing entirely
   by default, but a custom value can be set with the --max-missing-rows option.
1. `missing_consec_entries_high.csv`: A list of files where the maximum consecutive number of rows missing exceeds 
   a threshold. The threshold is currently set to a maximum of 48 consecutive empty rows, but a custom value can 
   be set with the --max-consecutive-missing-rows option.
1. `files_to_convert.csv`: A list of the files that are deemed to be usable because they are neither missing too many
   total nor too many consecutive rows. This file determines which EPWs will be generated by the next script, and
   it can be freely edited before running that script. Simply remove rows for any files that you do not want the 
   next script to process.

# 2. Create AMY EPW file

The script create_amy_epw.py will create EPW files by using information for selected variables from the
NOAA AMY files to replace the values for those same variables in a TMY3 file for the same station number. 
That is, the following 5 variables will consist of AMY data taken from the NOAA ISD Lite dataset with the remainder
of the file consisting of the corresponding WMO station's TMY3 EPW file, taken
from the `inputs/EnergyPlus_TMY3_EPW` directory.

1. dry bulb temperature
1. dew point temperature
1. pressure
1. wind direction
1. wind speed

For each of the NOAA AMY files containing 8760 hourly records, this script will ensure that in each record a value is 
present for all of the hourly timestamps for the variables shown above. To do so, it will use one of two strategies to
impute values for any missing fields in the data set. For more information, including on how to customize how that
imputation is performed, pass the --help option to this script.

This script will also convert these quantities from NOAA units to units consistent with those expected in an EPW file, 
as shown in [the EPW data dictionary](https://bigladdersoftware.com/epx/docs/8-3/auxiliary-programs/energyplus-weather-file-epw-data-dictionary.html).
  
## Reading in TMY3 files and writing EPW files
Functions for reading TMY3 files and writing EPW files within this script were taken or adapted from the 
[LAF.py script](https://github.com/SSESLab/laf/blob/master/LAF.py) by Carlo Bianchi at the Site-Specific Energy Systems 
Lab repository.

# Optional: Look up station location
The script identify_wmo_station_location.py contains a function of the same name that accepts a WMO station number 
(as an integer) and returns the state and county of that WMO station.
